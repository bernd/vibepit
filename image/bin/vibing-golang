#!/bin/bash

set -eo pipefail

arch=""
case "$(uname -m)" in
	x86_64)
		arch="amd64"
		;;
	*)
		arch="arm64"
		;;
esac

version="$(curl -fsSL "https://golang.org/dl/?mode=json&include=all" | jq -r '[.[] | select(.stable == true)] | .[].version' | sort -V | tail -1)"
url="https://go.dev/dl/${version}.linux-${arch}.tar.gz"

echo "+ Installing $version"

mkdir -p "$HOME/.local/bin"
curl -fsSL "$url" | tar -C "$HOME/.local" -xzf -

ln -s "$HOME/.local/go/bin/go" "$HOME/.local/bin/go"
ln -s "$HOME/.local/go/bin/gofmt" "$HOME/.local/bin/gofmt"
