#!/bin/bash

set -eo pipefail

arch=""
case "$(uname -m)" in
	x86_64)
		arch="amd64"
		;;
	*)
		arch="arm64"
		;;
esac

version="$(curl -fsSL "https://golang.org/dl/?mode=json&include=all" | jq -r '[.[] | select(.stable == true)] | .[].version' | sort -V | tail -1)"
url="https://go.dev/dl/${version}.linux-${arch}.tar.gz"

echo "+ Installing $version"
curl -fsSL "$url" | sudo tar -C "/usr/local" -xzf -

sudo ln -s "/usr/local/go/bin/go" "/usr/local/bin/go"
sudo ln -s "/usr/local/go/bin/gofmt" "/usr/local/bin/gofmt"
